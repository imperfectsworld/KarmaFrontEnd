<div class="container">


  @if (googleUser.googleId != null) {
  <h1>Welcome {{ googleUser.userName }}!</h1>
  <button class="btn btn-success" (click)="toggleFormDisplay()">Donate an Item</button>
  }
  @else {
  <h1>Welcome!</h1>
  }

  @if(newItem){
  <div id="testing" style="--bs-bg-opacity: .5; z-index: 1050;"
    class="bg-dark position-fixed top-0 start-0 bottom-0 end-0">
    <div class="bg-light rounded p-4 border border-dark position-fixed top-50 start-50 translate-middle"
      style="width: 400px;">
      <h5 class="text-center mb-3">Add New Item</h5>
      <div class="mb-3">
        <label for="itemName" class="form-label">Item Name:</label>
        <input type="text" id="itemName" class="form-control" [(ngModel)]="formItem.name" />
      </div>
      <div class="mb-3">
        <label for="itemDescription" class="form-label">Item Description:</label>
        <input type="text" id="itemDescription" class="form-control" [(ngModel)]="formItem.description" />
      </div>

      <div class="mb-3">
        <label for="categorySelect" class="form-label">Category:</label>
        <select id="categorySelect" class="form-select" [(ngModel)]="selectedCategory">
          @for(c of category; track $index) {
          <option [value]="c.label">{{ c.label }}</option>
          }
        </select>
      </div>
      <div class="mb-3">
        <label for="conditionSelect" class="form-label">Condition:</label>
        @if(selectedCategory === "Services" || selectedCategory === "Food") {
        <select id="conditionSelect" class="form-select" [(ngModel)]="selectedCondition" disabled>
          <option value="" disabled selected>Select condition</option>
        </select>
        } @else{
        <select id="conditionSelect" class="form-select" [(ngModel)]="selectedCondition">
          @for(c of condition; track $index) {
          <option [value]="c.label">{{ c.label }}</option>
          }
        </select>
        }
        <div class="mb-3">
          <p>Location: <input type="text" class="form-control" [(ngModel)]="formItem.geoCode" /></p>
          <p> Ex: 13700 Middlebelt Rd, Livonia, MI</p>
        </div>
        <input type="file" (change)="onFileSelected($event)" class="file-input" />
        <div class="text-center">
          @if(selectedFile){
          <button (click)="uploadImageAndAddItem()">Submit</button>
          }
          <button class="--bs--success" (click)="toggleFormDisplay()">Back</button>
        </div>
      </div>
    </div>
  </div>
  }



  <div class="row">
    <!-- Sort by -->
    <div class="col-md-4">
      <p>
        Sort by:
        <select class="form-control" (change)="onSortChange($event)">
          <option value="" disabled selected>Select sorting option</option>
          <option value="newest">Most Recent</option>
          <option value="oldest">Oldest</option>
          <option value="alphabetical">A-Z</option>
          <option value="reverseAlphabetical">Z-A</option>
        </select>
      </p>
    </div>

    <!-- Condition filter -->
    <div class="col-md-4">
      <p>
        Condition:
        <select class="form-control" [(ngModel)]="selectedCondition" (change)="onConditionChange(selectedCondition)">
          <option value="">All Conditions</option>
          <option value="Mint">Mint</option>
          <option value="Like New">Like New</option>
          <option value="Used">Used</option>
          <option value="Worn">Worn</option>
          <option value="Broken">Broken</option>
        </select>
      </p>
    </div>

    <!-- Category filter -->
    <div class="col-md-4">
      <p>
        Filter by Category:
        <select class="form-control" [(ngModel)]="selectedCategory" (change)="onCategoryChange(selectedCategory)">
          <option value="">All Categories</option>
          <option value="Food">Food</option>
          <option value="Furniture">Furniture</option>
          <option value="Car Seats">Car Seats</option>
          <option value="Electronics">Electronics</option>
          <option value="Clothing">Clothing</option>
          <option value="Stroller">Stroller</option>
          <option value="Nursing & Feeding">Nursing & Feeding</option>
          <option value="Playards">Playards</option>
          <option value="Bassinets">Bassinets</option>
          <option value="Infant Activity">Infant Activity</option>
          <option value="Infant Toys">Infant Toys</option>
        </select>
      </p>
    </div>
  </div>
  <div class="row border-bottom">
    @for(i of filteredItems; track i.id){

    <div class="col-md-4 mb-4">
      <div class="card" style="width: 300px; height: 620px;">
        @if(i.pic){
        <img [src]="i.pic" alt="{{ i.name }}" class="card-img-top img-thumbnail"
          style="width: 100%; height: 250px; object-fit: cover; cursor: pointer;" data-bs-toggle="modal"
          data-bs-target="#imageModal" (click)="setModalContent(i.pic, i.name)" />
        }

        <div class="card-body">
          <h5 class="card-title">{{ i.name }}</h5>
          <p class="card-text">{{ i.description }}</p>
          <p class="card-text"><strong>Condition:</strong> {{ i.condition }}</p>
          <button (click)="openLocation(i.geoCode)" class="btn btn-primary mb-2 me-4">Location</button>

          <!-- Show delete button if the item's googleId matches -->
          @if(i.googleId === googleUser.googleId){
          <button (click)="deleteItem(i.id)" class="btn btn-danger mb-2">Delete</button>
          }

          <!-- Show posted by user if available -->
          @if(i.google != null){
          <div class="mt-2 d-flex align-items-center">
            <!-- Google profile picture with rounded style -->
            <img [src]="i.google.profilePic" class="rounded-circle me-2" style="width: 40px; height: 40px;" />
            <p class="mb-0">Posted by {{ i.google.userName }}</p>
          </div>
          }
        </div>
      </div>
    </div>
    <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="imageModalLabel">{{ modalTitle }}</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <img [src]="modalImageSrc" class="img-fluid" alt="{{ modalTitle }}" />
          </div>
        </div>
      </div>
    </div>
    }
  </div>

</div>